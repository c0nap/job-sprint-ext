<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobSprint Settings</title>
    <link rel="stylesheet" href="popup.css">
    <style>
        body {
            width: 500px;
            min-height: 600px;
        }

        .settings-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .settings-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="url"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #7f8c8d;
            font-size: 12px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 1;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            flex: 1;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-link {
            background: #27ae60;
            color: white;
            text-decoration: none;
            padding: 10px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-link:hover {
            background: #229954;
        }

        .btn-link.disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .sheet-connection {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .connection-status {
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: #3498db;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .config-download {
            margin-top: 10px;
        }

        .config-download button {
            width: 100%;
        }

        /* Clipboard folder styles */
        .clipboard-folder {
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        .folder-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: white;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .folder-header:hover {
            background: #f0f0f0;
        }

        .folder-header.expanded {
            background: #e8f4f8;
        }

        .folder-icon {
            font-size: 12px;
            color: #666;
            transition: transform 0.2s;
        }

        .folder-header.expanded .folder-icon {
            transform: rotate(90deg);
        }

        .folder-title {
            font-weight: 500;
            font-size: 14px;
            color: #333;
        }

        .folder-content {
            padding: 12px;
            background: #fafafa;
            border-top: 1px solid #ddd;
        }

        .folder-json-editor {
            width: 100%;
            min-height: 120px;
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 12px;
            resize: vertical;
            background: white;
        }

        .folder-json-editor:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }

        .folder-json-editor.error {
            border-color: #e74c3c;
            background: #fff5f5;
        }

        .folder-hint {
            font-size: 11px;
            color: #666;
            margin-top: 6px;
        }

        .folder-error {
            font-size: 12px;
            color: #e74c3c;
            margin-top: 6px;
            padding: 6px 8px;
            background: #fff5f5;
            border-radius: 4px;
            display: none;
        }

        .folder-error.visible {
            display: block;
        }

        /* Tooltip styles */
        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            background: #3498db;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
            position: relative;
            vertical-align: middle;
        }

        .help-icon:hover {
            background: #2980b9;
        }

        .tooltip {
            position: relative;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: #2c3e50;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.5;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="popup.html" class="back-link">‚Üê Back to Main</a>

        <header>
            <h1>Settings</h1>
        </header>

        <!-- Clipboard Macros Configuration -->
        <div class="settings-section">
            <h3>Clipboard Macros</h3>

            <div class="alert alert-info">
                Configure your personal information organized by category. Edit the JSON for each folder to add, remove, or modify items. These values are stored locally in your browser and are never sent to any server.
            </div>

            <!-- Demographics folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="demographics">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üë§ Demographics</span>
                </div>
                <div class="folder-content" id="folder-demographics" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="demographics" placeholder='{"phone": "", "email": "", "address": "", "name": "", "linkedin": "", "website": ""}'></textarea>
                    <div class="folder-hint">JSON object with key-value pairs. Values can be strings or nested objects. Nested objects will be verbalized as lists when pasted.</div>
                    <div class="folder-error" data-folder="demographics"></div>
                </div>
            </div>

            <!-- References folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="references">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üìã References</span>
                </div>
                <div class="folder-content" id="folder-references" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="references" placeholder='{"reference1": "Name, Title, Company, Email, Phone", "reference2": "..."}'></textarea>
                    <div class="folder-hint">Add your professional references with their contact information.</div>
                    <div class="folder-error" data-folder="references"></div>
                </div>
            </div>

            <!-- Education folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="education">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üéì Education</span>
                </div>
                <div class="folder-content" id="folder-education" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="education" placeholder='{"degree1": "BS Computer Science, University Name, 2020", "degree2": "..."}'></textarea>
                    <div class="folder-hint">Add your educational background and degrees.</div>
                    <div class="folder-error" data-folder="education"></div>
                </div>
            </div>

            <!-- Skills folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="skills">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üí° Skills</span>
                </div>
                <div class="folder-content" id="folder-skills" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="skills" placeholder='{"technical": "Python, JavaScript, React, Node.js", "languages": "English (Native), Spanish (Fluent)"}'></textarea>
                    <div class="folder-hint">Organize your skills by category or list them individually.</div>
                    <div class="folder-error" data-folder="skills"></div>
                </div>
            </div>

            <!-- Projects folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="projects">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üöÄ Projects</span>
                </div>
                <div class="folder-content" id="folder-projects" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="projects" placeholder='{"project1": "E-commerce Platform - Built with React/Node.js", "project2": "..."}'></textarea>
                    <div class="folder-hint">Add descriptions of your key projects and accomplishments.</div>
                    <div class="folder-error" data-folder="projects"></div>
                </div>
            </div>

            <!-- Employment folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="employment">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üíº Employment</span>
                </div>
                <div class="folder-content" id="folder-employment" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="employment" placeholder='{"current": "Senior Engineer at Tech Corp (2020-Present)", "previous": "..."}'></textarea>
                    <div class="folder-hint">Add your work history and employment details.</div>
                    <div class="folder-error" data-folder="employment"></div>
                </div>
            </div>

            <!-- Search settings -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <h4 style="margin-bottom: 10px; font-size: 14px;">Search Settings</h4>
                <div class="form-group">
                    <label for="maxSearchResults">
                        Maximum Search Results
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltip-text">Controls how many clipboard macro items appear in the search dropdown when you search for items. Higher values show more results but may make the dropdown longer. Range: 5-50.</span>
                        </span>
                    </label>
                    <input type="number" id="maxSearchResults" min="5" max="50" value="10" style="width: 100px;">
                    <small>Number of results to show in search dropdown (5-50)</small>
                </div>
            </div>

            <!-- Debug Console settings -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <h4 style="margin-bottom: 10px; font-size: 14px;">Debug Console</h4>
                <div class="checkbox-group">
                    <input type="checkbox" id="debugConsoleEnabled">
                    <label for="debugConsoleEnabled">
                        Enable Debug Console
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltip-text">When enabled, shows a console panel at the bottom of the popup window. Useful for troubleshooting extension operations and viewing detailed logs of clipboard actions, autofill operations, and API calls.</span>
                        </span>
                    </label>
                </div>
                <small style="margin-left: 28px; display: block; margin-top: 5px;">Shows a console panel at the bottom of the popup for debugging extension operations</small>
            </div>

            <!-- Save button for clipboard macros -->
            <div style="margin-top: 20px;">
                <button id="saveClipboardMacros" class="btn-primary">Save Clipboard Macros</button>
                <div id="clipboardSaveStatus" class="status-message" style="margin-top: 10px;"></div>
            </div>
        </div>

        <!-- Autofill Q&A Database -->
        <div class="settings-section">
            <h3>
                Autofill Q&A Database
                <span class="tooltip">
                    <span class="help-icon">?</span>
                    <span class="tooltip-text">Manage your question-answer pairs for semi-supervised autofill. The extension will automatically suggest answers when it finds matching questions on job application forms.</span>
                </span>
            </h3>

            <div class="alert alert-info">
                <strong>ü§ñ Smart Autofill:</strong> Add question-answer pairs to build your personal autofill database. The system will intelligently match questions on forms and suggest your answers for approval.
            </div>

            <!-- Search and Filter -->
            <div style="margin-bottom: 15px;">
                <input type="text" id="qaSearchInput" placeholder="Search questions or answers..." style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 14px; margin-bottom: 10px;">

                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="addQAButton" class="btn-primary" style="padding: 8px 16px;">+ Add New Q&A</button>
                    <span id="qaCountDisplay" style="color: #666; font-size: 13px;"></span>
                </div>
            </div>

            <!-- Q&A List -->
            <div id="qaListContainer" style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px; background: white;">
                <div id="qaList" style="padding: 10px;">
                    <!-- Q&A items will be populated here -->
                </div>
            </div>

            <!-- Add/Edit Q&A Modal -->
            <div id="qaModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
                <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <h3 style="margin-top: 0; margin-bottom: 20px;" id="qaModalTitle">Add Q&A Pair</h3>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">Question</label>
                        <input type="text" id="qaModalQuestion" placeholder="e.g., Are you authorized to work in the U.S.?" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                        <small style="display: block; margin-top: 5px; color: #666;">Enter the question exactly as it appears on forms</small>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">Answer</label>
                        <input type="text" id="qaModalAnswer" placeholder="e.g., Yes" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                        <small style="display: block; margin-top: 5px; color: #666;">Your response to this question</small>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #333;">
                            Answer Type
                            <span class="tooltip">
                                <span class="help-icon">?</span>
                                <span class="tooltip-text">Helps the system intelligently match answers. 'Exact' requires perfect match. 'Choice' handles variations like "Yes", "Yes with conditions", "No". 'Text' is for open-ended responses.</span>
                            </span>
                        </label>
                        <select id="qaModalType" style="width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 14px;">
                            <option value="choice">Choice (Yes/No, Multiple Choice)</option>
                            <option value="text">Text (Open-ended response)</option>
                            <option value="exact">Exact Match (Specific value)</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button id="qaModalCancel" class="btn-secondary" style="padding: 10px 20px;">Cancel</button>
                        <button id="qaModalSave" class="btn-primary" style="padding: 10px 20px;">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Google Sheets Configuration -->
        <div class="settings-section">
            <h3>Google Sheets Configuration</h3>

            <div class="alert alert-info">
                <strong>üîí Security Note:</strong> Your Spreadsheet ID and Project ID are stored server-side in Apps Script using Script Properties. They are NEVER sent over the network. The extension stores them locally only for your convenience (to open the sheet directly).
            </div>

            <div class="form-group">
                <label for="appsScriptEndpoint">
                    Apps Script Endpoint URL
                    <span class="tooltip">
                        <span class="help-icon">?</span>
                        <span class="tooltip-text">This is the public URL of your deployed Google Apps Script web app. Find it by deploying your Apps Script project as a web app. This is the only URL that receives requests from the extension.</span>
                    </span>
                </label>
                <input type="url" id="appsScriptEndpoint" placeholder="https://script.google.com/macros/s/.../exec">
                <small>The URL of your deployed Google Apps Script web app (this is the only value sent in requests)</small>
            </div>

            <div class="form-group">
                <label for="spreadsheetId">
                    Google Spreadsheet ID
                    <span class="tooltip">
                        <span class="help-icon">?</span>
                        <span class="tooltip-text">Found in your Google Sheet URL between /d/ and /edit. Example: docs.google.com/spreadsheets/d/<strong>SPREADSHEET_ID</strong>/edit. This ID is stored locally and used to configure Apps Script and open the sheet directly.</span>
                    </span>
                </label>
                <input type="text" id="spreadsheetId" placeholder="1a2B3c4D5e6F7g8H9i0J...">
                <small>Found in the URL: docs.google.com/spreadsheets/d/<strong>SPREADSHEET_ID</strong>/edit<br>
                Used to: (1) Configure Apps Script via setupConfiguration(), (2) Open sheet from extension</small>
            </div>

            <div class="form-group">
                <label for="projectId">
                    Google Cloud Project ID
                    <span class="tooltip">
                        <span class="help-icon">?</span>
                        <span class="tooltip-text">Your Google Cloud Project's numeric ID (not the project name). Find it in the Google Cloud Console dashboard. Used for Apps Script configuration and logging purposes.</span>
                    </span>
                </label>
                <input type="text" id="projectId" placeholder="123456789012">
                <small>Your Google Cloud numeric project ID (for Apps Script configuration and logging)</small>
            </div>

            <div class="sheet-connection">
                <div id="connectionStatus" class="connection-status disconnected">
                    Not connected to Google Sheets
                </div>
                <button id="testConnection" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">Test Connection</button>
                <a id="openSheetLink" href="#" class="btn-link disabled">Open Google Sheet</a>
            </div>
        </div>

        <!-- Job Data Extraction Settings -->
        <div class="settings-section">
            <h3>Job Data Extraction</h3>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="enableManualEntry" checked>
                    <label for="enableManualEntry">
                        Show manual entry form when extraction fails
                        <span class="tooltip">
                            <span class="help-icon">?</span>
                            <span class="tooltip-text">When job data extraction fails or returns incomplete information, a form will appear allowing you to manually fill in missing details like job title, company, and location before submitting to Google Sheets.</span>
                        </span>
                    </label>
                </div>
                <small style="margin-left: 28px;">When enabled, you can manually fill in missing job data before submitting</small>
            </div>
        </div>

        <!-- Full Backup & Restore -->
        <div class="settings-section">
            <h3>
                Full Backup & Restore
                <span class="tooltip">
                    <span class="help-icon">?</span>
                    <span class="tooltip-text">Export all extension data including clipboard macros, Q&A database, and all settings to a JSON file. Import to restore everything. Perfect for switching devices or backing up before reinstall.</span>
                </span>
            </h3>

            <div class="alert alert-info">
                <strong>üíæ Complete Backup:</strong> Export and import ALL extension data including clipboard macros, autofill Q&A database, and all settings. This is the recommended way to backup or transfer your extension configuration.
            </div>

            <div class="config-download">
                <button id="exportAllSettings" class="btn-primary" style="margin-bottom: 10px; background: #27ae60;">üì§ Export All Settings</button>
                <small style="display: block; margin-bottom: 15px;">Download a complete backup of all extension data as a JSON file</small>

                <button id="importAllSettings" class="btn-primary" style="background: #e67e22;">üì• Import All Settings</button>
                <small style="display: block; margin-top: 8px;">Upload a backup file to restore all extension data</small>
            </div>

            <!-- Hidden file input for import -->
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>

        <!-- Configuration File Management -->
        <div class="settings-section">
            <h3>Configuration File (Legacy)</h3>

            <div class="alert alert-info">
                Settings are stored in Chrome sync storage and can be exported to <code>config.local.js</code> for the service worker. Your configuration is stored locally in the extension only - sensitive IDs are configured server-side in Apps Script and never transmitted over the network.
            </div>

            <div class="config-download">
                <button id="uploadConfig" class="btn-secondary" style="margin-bottom: 10px;">Upload config.local.js</button>
                <small style="display: block; margin-bottom: 15px;">Upload an existing config.local.js file to populate settings</small>

                <button id="downloadConfig" class="btn-secondary">Download config.local.js</button>
                <small style="display: block; margin-top: 8px;">Download the configuration file to use with the extension</small>
            </div>

            <!-- Hidden file input for upload -->
            <input type="file" id="configFileInput" accept=".js" style="display: none;">
        </div>

        <!-- Privacy Controls -->
        <div class="section">
            <h2>Privacy Controls</h2>
            <p class="section-description">
                Manage your extension data. This includes clipboard macros (phone, email, etc.),
                autofill Q&A database, and all settings. This action cannot be undone.
            </p>
            <div>
                <button id="clearAllData" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 500;">
                    Clear All Data
                </button>
                <small style="display: block; margin-top: 8px; color: #e74c3c;">
                    ‚ö†Ô∏è Warning: This will permanently delete all clipboard macros, autofill answers, and settings
                </small>
            </div>
        </div>

        <!-- Save Buttons -->
        <div class="button-group">
            <button id="saveSettings" class="btn-primary">Save Settings</button>
            <button id="resetSettings" class="btn-secondary">Reset to Defaults</button>
        </div>

        <div id="saveStatus" class="status-message" style="margin-top: 15px;"></div>
    </div>

    <script src="settings.js"></script>
</body>
</html>
