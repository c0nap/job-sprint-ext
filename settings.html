<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobSprint Settings</title>
    <link rel="stylesheet" href="popup.css">
    <style>
        body {
            width: 500px;
            min-height: 600px;
        }

        .settings-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .settings-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="url"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #7f8c8d;
            font-size: 12px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 1;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            flex: 1;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-link {
            background: #27ae60;
            color: white;
            text-decoration: none;
            padding: 10px;
            border-radius: 4px;
            display: inline-block;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-link:hover {
            background: #229954;
        }

        .btn-link.disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .sheet-connection {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .connection-status {
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: #3498db;
            text-decoration: none;
            font-size: 14px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .config-download {
            margin-top: 10px;
        }

        .config-download button {
            width: 100%;
        }

        /* Clipboard folder styles */
        .clipboard-folder {
            margin-bottom: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        .folder-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: white;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .folder-header:hover {
            background: #f0f0f0;
        }

        .folder-header.expanded {
            background: #e8f4f8;
        }

        .folder-icon {
            font-size: 12px;
            color: #666;
            transition: transform 0.2s;
        }

        .folder-header.expanded .folder-icon {
            transform: rotate(90deg);
        }

        .folder-title {
            font-weight: 500;
            font-size: 14px;
            color: #333;
        }

        .folder-content {
            padding: 12px;
            background: #fafafa;
            border-top: 1px solid #ddd;
        }

        .folder-json-editor {
            width: 100%;
            min-height: 120px;
            padding: 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 12px;
            resize: vertical;
            background: white;
        }

        .folder-json-editor:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }

        .folder-json-editor.error {
            border-color: #e74c3c;
            background: #fff5f5;
        }

        .folder-hint {
            font-size: 11px;
            color: #666;
            margin-top: 6px;
        }

        .folder-error {
            font-size: 12px;
            color: #e74c3c;
            margin-top: 6px;
            padding: 6px 8px;
            background: #fff5f5;
            border-radius: 4px;
            display: none;
        }

        .folder-error.visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="popup.html" class="back-link">‚Üê Back to Main</a>

        <header>
            <h1>Settings</h1>
        </header>

        <!-- Clipboard Macros Configuration -->
        <div class="settings-section">
            <h3>Clipboard Macros</h3>

            <div class="alert alert-info">
                Configure your personal information organized by category. Edit the JSON for each folder to add, remove, or modify items. These values are stored locally in your browser and are never sent to any server.
            </div>

            <!-- Demographics folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="demographics">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üë§ Demographics</span>
                </div>
                <div class="folder-content" id="folder-demographics" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="demographics" placeholder='{"phone": "", "email": "", "address": "", "name": "", "linkedin": "", "website": ""}'></textarea>
                    <div class="folder-hint">JSON object with key-value pairs. Values can be strings or nested objects. Nested objects will be verbalized as lists when pasted.</div>
                    <div class="folder-error" data-folder="demographics"></div>
                </div>
            </div>

            <!-- References folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="references">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üìã References</span>
                </div>
                <div class="folder-content" id="folder-references" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="references" placeholder='{"reference1": "Name, Title, Company, Email, Phone", "reference2": "..."}'></textarea>
                    <div class="folder-hint">Add your professional references with their contact information.</div>
                    <div class="folder-error" data-folder="references"></div>
                </div>
            </div>

            <!-- Education folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="education">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üéì Education</span>
                </div>
                <div class="folder-content" id="folder-education" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="education" placeholder='{"degree1": "BS Computer Science, University Name, 2020", "degree2": "..."}'></textarea>
                    <div class="folder-hint">Add your educational background and degrees.</div>
                    <div class="folder-error" data-folder="education"></div>
                </div>
            </div>

            <!-- Skills folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="skills">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üí° Skills</span>
                </div>
                <div class="folder-content" id="folder-skills" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="skills" placeholder='{"technical": "Python, JavaScript, React, Node.js", "languages": "English (Native), Spanish (Fluent)"}'></textarea>
                    <div class="folder-hint">Organize your skills by category or list them individually.</div>
                    <div class="folder-error" data-folder="skills"></div>
                </div>
            </div>

            <!-- Projects folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="projects">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üöÄ Projects</span>
                </div>
                <div class="folder-content" id="folder-projects" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="projects" placeholder='{"project1": "E-commerce Platform - Built with React/Node.js", "project2": "..."}'></textarea>
                    <div class="folder-hint">Add descriptions of your key projects and accomplishments.</div>
                    <div class="folder-error" data-folder="projects"></div>
                </div>
            </div>

            <!-- Employment folder -->
            <div class="clipboard-folder">
                <div class="folder-header" data-folder="employment">
                    <span class="folder-icon">‚ñ∂</span>
                    <span class="folder-title">üíº Employment</span>
                </div>
                <div class="folder-content" id="folder-employment" style="display: none;">
                    <textarea class="folder-json-editor" data-folder="employment" placeholder='{"current": "Senior Engineer at Tech Corp (2020-Present)", "previous": "..."}'></textarea>
                    <div class="folder-hint">Add your work history and employment details.</div>
                    <div class="folder-error" data-folder="employment"></div>
                </div>
            </div>

            <!-- Search settings -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <h4 style="margin-bottom: 10px; font-size: 14px;">Search Settings</h4>
                <div class="form-group">
                    <label for="maxSearchResults">Maximum Search Results</label>
                    <input type="number" id="maxSearchResults" min="5" max="50" value="10" style="width: 100px;">
                    <small>Number of results to show in search dropdown (5-50)</small>
                </div>
            </div>

            <!-- Debug Console settings -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <h4 style="margin-bottom: 10px; font-size: 14px;">Debug Console</h4>
                <div class="checkbox-group">
                    <input type="checkbox" id="debugConsoleEnabled">
                    <label for="debugConsoleEnabled">Enable Debug Console</label>
                </div>
                <small style="margin-left: 28px; display: block; margin-top: 5px;">Shows a console panel at the bottom of the popup for debugging extension operations</small>
            </div>

            <!-- Save button for clipboard macros -->
            <div style="margin-top: 20px;">
                <button id="saveClipboardMacros" class="btn-primary">Save Clipboard Macros</button>
                <div id="clipboardSaveStatus" class="status-message" style="margin-top: 10px;"></div>
            </div>
        </div>

        <!-- Google Sheets Configuration -->
        <div class="settings-section">
            <h3>Google Sheets Configuration</h3>

            <div class="alert alert-info">
                <strong>üîí Security Note:</strong> Your Spreadsheet ID and Project ID are stored server-side in Apps Script using Script Properties. They are NEVER sent over the network. The extension stores them locally only for your convenience (to open the sheet directly).
            </div>

            <div class="form-group">
                <label for="appsScriptEndpoint">Apps Script Endpoint URL</label>
                <input type="url" id="appsScriptEndpoint" placeholder="https://script.google.com/macros/s/.../exec">
                <small>The URL of your deployed Google Apps Script web app (this is the only value sent in requests)</small>
            </div>

            <div class="form-group">
                <label for="spreadsheetId">Google Spreadsheet ID</label>
                <input type="text" id="spreadsheetId" placeholder="1a2B3c4D5e6F7g8H9i0J...">
                <small>Found in the URL: docs.google.com/spreadsheets/d/<strong>SPREADSHEET_ID</strong>/edit<br>
                Used to: (1) Configure Apps Script via setupConfiguration(), (2) Open sheet from extension</small>
            </div>

            <div class="form-group">
                <label for="projectId">Google Cloud Project ID</label>
                <input type="text" id="projectId" placeholder="123456789012">
                <small>Your Google Cloud numeric project ID (for Apps Script configuration and logging)</small>
            </div>

            <div class="sheet-connection">
                <div id="connectionStatus" class="connection-status disconnected">
                    Not connected to Google Sheets
                </div>
                <button id="testConnection" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">Test Connection</button>
                <a id="openSheetLink" href="#" class="btn-link disabled">Open Google Sheet</a>
            </div>
        </div>

        <!-- Job Data Extraction Settings -->
        <div class="settings-section">
            <h3>Job Data Extraction</h3>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="enableManualEntry" checked>
                    <label for="enableManualEntry">Show manual entry form when extraction fails</label>
                </div>
                <small style="margin-left: 28px;">When enabled, you can manually fill in missing job data before submitting</small>
            </div>
        </div>

        <!-- Configuration File Management -->
        <div class="settings-section">
            <h3>Configuration File</h3>

            <div class="alert alert-info">
                Settings are stored in Chrome sync storage and can be exported to <code>config.local.js</code> for the service worker. Your configuration is stored locally in the extension only - sensitive IDs are configured server-side in Apps Script and never transmitted over the network.
            </div>

            <div class="config-download">
                <button id="uploadConfig" class="btn-secondary" style="margin-bottom: 10px;">Upload config.local.js</button>
                <small style="display: block; margin-bottom: 15px;">Upload an existing config.local.js file to populate settings</small>

                <button id="downloadConfig" class="btn-secondary">Download config.local.js</button>
                <small style="display: block; margin-top: 8px;">Download the configuration file to use with the extension</small>
            </div>

            <!-- Hidden file input for upload -->
            <input type="file" id="configFileInput" accept=".js" style="display: none;">
        </div>

        <!-- Privacy Controls -->
        <div class="section">
            <h2>Privacy Controls</h2>
            <p class="section-description">
                Manage your extension data. This includes clipboard macros (phone, email, etc.),
                autofill Q&A database, and all settings. This action cannot be undone.
            </p>
            <div>
                <button id="clearAllData" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 500;">
                    Clear All Data
                </button>
                <small style="display: block; margin-top: 8px; color: #e74c3c;">
                    ‚ö†Ô∏è Warning: This will permanently delete all clipboard macros, autofill answers, and settings
                </small>
            </div>
        </div>

        <!-- Save Buttons -->
        <div class="button-group">
            <button id="saveSettings" class="btn-primary">Save Settings</button>
            <button id="resetSettings" class="btn-secondary">Reset to Defaults</button>
        </div>

        <div id="saveStatus" class="status-message" style="margin-top: 15px;"></div>
    </div>

    <script src="settings.js"></script>
</body>
</html>
